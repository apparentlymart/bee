<div id="entry-editor" class="entry">
    <h2 class="entry-header" contenteditable="true">Title</h2>
    <!-- author -->
    <div class="entry-content pkg" contenteditable="true"><p>content goes here</p></div>
    <div class="entry-footer">
        <span>
            <input type="datetime-local" name="entry-published" id="entry-published">
        </span>
        <span>Permalink: <span id="entry-slug" contenteditable="true">title</span></span>
        <span class="editor-buttons" style="display: inline-block; float: right;">
            <a id="editor-post-button" href="#" class="button button-green">Post</a>
            <a href="#" class="button button-black">Discard</a>
        </span>
    </div>
</div>

<script type="text/javascript">
    var $publ = $('#entry-published');
    try { $publ.attr('type', 'datetime'); } catch(e) {}
    if ($publ.attr('type') == 'text') {
        alert('TEXT :|')
    }
    else {
        alert('TYPE ' + $publ.attr('type') + ' :|')
    }

    $('#entry-editor .entry-header').bind('keypress', function (e) {
        if (e.which == 13)
            return false;
    }).bind('keyup', function (e) {
        var $slug = $('#entry-slug');
        if ($slug.data('edited'))
            return;

        var title = $(this).text();
        var slug = title.replace(/\s+/g,'-').replace(/[^a-zA-Z0-9\-]/g,'').replace(/--+/g, '-').replace(/^-|-$/g, '').toLowerCase();
        $slug.text(slug);
    });

    $('#entry-slug').bind('keypress', function (e) {
        if (e.which != 45 && (e.which < 97 || 122 < e.which))
            return false;

        $(this).data('edited', true);
    });

    $('#editor-post-button').click(function (e) {
        $.ajax({
            url: '/_/edit',
            type: 'POST',
            dataType: 'json',
            data: {
                //avatar: 
                title: $('#entry-editor .entry-header').text(),
                html: $('#entry-editor .entry-content').html(),
                slug: $('#entry-slug').text(),
                private: true
                //private_to: 
                //published: 
            },
            success: function (data, textStatus, xhr) {
                window.location = data['permalink'];
            },
            error: function (xhr, textStatus, errorThrown) {
                alert('ERROR: ' + xhr.responseText);
            }
        });
        return false;
    });
</script>
